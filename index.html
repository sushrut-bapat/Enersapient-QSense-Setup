<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EnerSapient Device Setup</title>
<style>
/* Shared CSS */
body{font-family:Arial,sans-serif;background:#f5f5f5;margin:0;padding:20px;display:flex;justify-content:center}
.container{background:#fff;padding:25px;border-radius:12px;box-shadow:0 0 15px rgba(0,0,0,.1);width:100%;max-width:420px;box-sizing:border-box}
h2{text-align:center;color:#333;margin-bottom:10px}
h3{color:#333;margin-bottom:5px}
.section{margin-bottom:10px;display:flex;gap:5px;align-items:center}
.button,a.button,input[type=submit]{display:block;width:auto;padding:12px;margin:8px 0;background:#07F;color:#fff;border:none;border-radius:5px;font-size:15px;text-align:center;text-decoration:none;cursor:pointer;transition:background-color .3s}
.button:hover{background:#0056b3}
input[type=text]{flex:1;padding:10px;margin:5px 0;border:1px solid #ccc;border-radius:5px;background:#f9f9f9}
input[readonly]{background:#eee;border:none}
.status{font-size:12px;color:#777;margin-top:20px;text-align:left;line-height:1.6}
.button-row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
.button-row .button{flex:1;min-width:120px}
.button.green{background:#28a745}
.button.red{background:#dc3545}
.button.disabled{opacity:0.5;cursor:not-allowed}
ul{list-style:none;padding:0;margin:0}
#progressWrapper{width:100%;background:#ddd;border-radius:5px;overflow:hidden;margin-top:20px;height:22px;display:none}
#progressBar{height:100%;width:0%;background:#007BFF;color:white;text-align:center;line-height:22px;transition: width 0.1s;}
ul li{margin:10px 0}
.error{color:#d9534f}
.ok{color:#28a745}
.neutral{color:#000}
</style>
</head>
<body>
<div class="container">
  <!-- Shared header -->
  <div style='display:flex;align-items:center;justify-content:space-between;margin-bottom:20px'>
    <h2 style='margin:0'>EnerSapient&trade;</h2>
    <img src='https://img1.wsimg.com/isteam/ip/d28fe43b-51f2-49a9-be42-73f2bee9e7e6/blob-49e5029.png/:/cr=t:0%25,l:0%25,w:100%25,h:100%25/rs=w:1200,cg:true' alt='Logo' style='height:100px'>
  </div>

  <!-- Serial number form -->
  <h3>Enter Device Serial Number</h3>
  <div class="section">
    <input type="text" id="serialNumber" placeholder="Enter serial number">
    <button id="submitSerial" class="button green">Submit</button>
  </div>

  <!-- Connect button -->
  <button id="connectBtn" class="button disabled" disabled>Connect to Device</button>

  <!-- Link display for manual access -->
  <p id="deviceLink" class="status"></p>

  <!-- Status / instructions -->
  <p class="status" id="status">
    If this is your initial setup, connect to the <strong>ENERSAPIENT-QSENSE</strong> Wi-Fi, 
    enter your serial number, then click <strong>Submit</strong> and <strong>Connect to Device</strong>.
  </p>
</div>

<script>
const serialInput = document.getElementById('serialNumber');
const submitBtn = document.getElementById('submitSerial');
const connectBtn = document.getElementById('connectBtn');
const statusEl = document.getElementById('status');
const deviceLinkEl = document.getElementById('deviceLink');

submitBtn.addEventListener('click', () => {
  const serial = serialInput.value.trim().toLowerCase();
  if (!serial) {
    alert('Please enter a serial number!');
    return;
  }

  // Enable connect button
  connectBtn.disabled = false;
  connectBtn.classList.remove('disabled');
  connectBtn.classList.add('green');
  connectBtn.textContent = `Connect to Device`;
  statusEl.textContent = 'Click the green button below to open your device page.';

  // Save hostname
  const hostname = `enersapient-qsense-${serial}.local`;
  connectBtn.dataset.hostname = hostname;

  // Display link (safe for HTTPS page)
  const url = `http://${hostname}/`;
  deviceLinkEl.innerHTML = `ðŸ”— Or open manually: <a href="${url}" target="_blank">${hostname}</a>`;
});

connectBtn.addEventListener('click', () => {
  const hostname = connectBtn.dataset.hostname;
  if (!hostname) return;
  // Open directly in a new tab/window (bypasses mixed content restriction)
  window.open(`http://${hostname}/`, '_blank');
});
</script>
</body>
</html>
